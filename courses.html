<!doctype html>
<html lang="en" dir="ltr">

<head id="headSection">
    <!--code in header.js file-->
</head>

<body class="font-muli theme-cyan gradient">
    <!-- Page Loader -->
    <div class="page-loader-wrapper">
        <div class="loader">
        </div>
    </div>

    <div id="main_content">
        <!-- Start Main top header -->
        <div id="header_top" class="header_top">
            <div class="container">

                <div class="hleft">
                    <a class="header-brand" href="index.html"><i class="fa fa-graduation-cap brand-logo"></i></a>
                    <div class="dropdown">
                        <a href="javascript:void(0)" class="nav-link icon menu_toggle"><i class="fe fe-align-center"></i></a>
                    </div>
                </div>
                <div class="hright">

                </div>
            </div>
        </div>

        <!-- Start Main leftbar navigation -->
        <div id="left-sidebar" class="sidebar">
            <!--code in header.js file-->
        </div>
        <!-- Start project content area -->
        <div class="page">
            <!-- Start Page header -->
            <div class="section-body" id="page_top">
                <!--code in header.js file-->
            </div>
            <!-- Start Page title and tab -->
            <div class="section-body">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between align-items-center ">
                        <div class="header-action">
                            <h1 class="page-title">Courses</h1>
                            <ol class="breadcrumb page-breadcrumb">
                                <li class="breadcrumb-item"><a href="#">SSAGRAWAL</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Courses</li>
                            </ol>
                        </div>
                        <ul class="nav nav-tabs page-header-tab">
                            <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#Courses-all">List View</a></li>
                            <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Courses-add">Add</a></li>
                            <li class="nav-item"><a class="nav-link" id="Courses-tab-Boot" data-toggle="tab" href="#Courses-add-Boot">Edit</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="section-body mt-4">
                <div class="container-fluid">
                    <div class="tab-content">
                        <div class="tab-pane active" id="Courses-all">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Course Information</h3>
                                    <div class="card-options ">
                                        <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                                        <a href="#" class="card-options-remove" data-toggle="card-remove"><i class="fe fe-x"></i></a>
                                    </div>
                                </div>
                                <table id="course_list" class="table table-responsive table-striped table-bordered  text-nowrap" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>ID</th>
                                            <th>Name Of Course</th>
                                            <th>Alias</th>
                                            <th>Institute</th>
                                            <th>Duration</th>
                                            <th>pattern</th>
                                            <th>Fees</th>
                                            <th>Intake</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane" id="Courses-add">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Add Course Information</h3>
                                    <div class="card-options ">
                                        <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>

                                    </div>
                                </div>
                                <div class="card-body">
                                    <form id="add_course">
                                        <div class="row clearfix">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="name" id="name" class="form-control" placeholder="Course Name ">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="alias" id="alias" class="form-control" placeholder="Alias Name">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="course_code" id="course_code" class="form-control" placeholder="Course Code ">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <select CLASS="form-control" id="institute_id">
                                                        <option value="0">-----------</option>
                                                    </select>

                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="number" name="duration" id="duration" class="form-control" placeholder="Duration in years">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input class="form-control" name="pattern" id="pattern" placeholder="Pattern">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="fees" id="fees" class="form-control" placeholder="Fees">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="number" name="intake" id="intake" class="form-control" placeholder="Intake">
                                                </div>
                                            </div>

                                            <div class="col-sm-12">
                                                <button type="submit" class="btn btn-primary">Submit</button>
                                                <button type="submit" class="btn btn-outline-secondary btn-default">Cancel</button>
                                            </div>

                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                        <div class="tab-pane" id="Courses-add-Boot">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Edit Course</h3>
                                    <div class="card-options ">
                                        <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>

                                    </div>
                                </div>
                                <div class="card-body">
                                    <form id="update_course">
                                        <div class="row clearfix">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_id" id="edit_id" class="form-control" placeholder="Course ID" width="15">
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_name" id="edit_name" class="form-control" placeholder="Course Name ">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_alias" id="edit_alias" class="form-control" placeholder="Alias Name">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_course_code" id="edit_course_code" class="form-control" placeholder="Course Code ">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_institute_id" id="edit_institute_id" class="form-control" placeholder="Institute ID">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="number" name="edit_duration" id="edit_duration" class="form-control" placeholder="Duration in years">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input class="form-control" name="edit_pattern" id="edit_pattern" placeholder="Pattern">
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="text" name="edit_fees" id="edit_fees" class="form-control" placeholder="Fees">
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input type="number" name="edit_intake" id="edit_intake" class="form-control" placeholder="Intake">
                                                </div>
                                            </div>

                                            <div class="col-sm-12">
                                                <button type="submit" class="btn btn-primary">Submit</button>
                                                <button type="submit" class="btn btn-outline-secondary btn-default">Cancel</button>
                                            </div>

                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Start Main project js, jQuery, Bootstrap -->
            <script src="assets/bundles/lib.vendor.bundle.js"></script>

            <!-- Start Plugin Js -->
            <script src="assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
            <script src="assets/plugins/dropify/js/dropify.min.js"></script>
            <script src="assets/bundles/summernote.bundle.js"></script>
            <script src="assets/plugins/sweetalert/sweetalert.min.js"></script>

            <!-- Start project main js  and page js -->
            <script src="assets/js/core.js"></script>
            <script src="assets/js/form/dropify.js"></script>
            <script src="assets/js/page/summernote.js"></script>
            <script src="assets/js/page/dialogs.js"></script>
            <script src="assets/DataTables/datatables.js"></script>
            <script src="header.js"></script>
            <script>
                $(document).ready(async() => {
                    let institutes_array = []
                    await $.ajax(`${url}/master/getInstitute`, {
                        type: 'GET',
                        success: async function(innerData, status, xhr) {
                            innerData.forEach(async(element) => {
                                await institutes_array.push({
                                    "alias": element.alias,
                                    "id": element.id
                                })
                            });

                        },
                        error: async function(jqXhr, textStatus, errorMessage) {
                            console.log('master/getInstitute', jqXhr.responseText)
                        }
                    })
                    $("#institute_id").html("")
                    $("#institute_id").append(`<option value="0">-----------</option>`)
                    institutes_array.forEach(element => {
                        $("#institute_id").append(`<option value="${element.id}">${element.alias}</option>`)
                    });

                    await $.ajax(`${url}/master/getCourse`, {
                        type: 'GET', // http method
                        success: async function(data, status, xhr) {
                            $("#course_list").find('tbody').empty()
                            await data.forEach(async(element) => {
                                institutes_array.forEach(record => {
                                    if (element.institute_id == record.id) {
                                        element.institute_alias = record.alias
                                    }
                                });

                                let tr = `<tr>
                                            <td>
                                                <button type="button"  class="btn btn-icon btn-sm edit" title="Edit" id="${element.id}"><i class="fa fa-edit"></i></button>
                                                <button type="button" class="btn btn-icon btn-sm delete" title="Delete" id="${element.id}"><i class="fa fa-trash-o text-danger"></i></button>
                                            </td>
                                            <td>${element.id}</td>
                                            <td>${element.name}</td>
                                            <td>${element.alias}</td>
                                            <td>${element.institute_alias}</td>
                                            <td>${element.duration}</td>
                                            <td>${element.pattern}</td>
                                            <td>${element.fees}</td>
                                            <td>${element.intake}</td>
                                        </tr>`;
                                $("#course_list").find('tbody').append(tr);
                            });
                            setTimeout(() => {
                                $("#course_list").dataTable();
                            }, 500);

                        },
                        error: function(jqXhr, textStatus, errorMessage) {
                            console.log('locho', jqXhr.responseText)
                        }
                    });

                    $("#add_course").submit(async(e) => {
                        e.preventDefault()
                        var formdata = $("#add_course").serializeArray();
                        var data = {};
                        formdata.forEach(element => {
                            data[element.name] = element.value;
                        });
                        data["institute_id"] = $("#institute_id").val()
                        await $.ajax(`${url}/master/addCourse`, {
                            "dataType": "json",
                            type: 'POST',
                            data: data,
                            success: async function(data, status, xhr) {
                                alert("New Record added succesfully ! !")
                                window.location.href = $(location).attr('href')
                            },
                            error: function(jqxhr, textStatus, errorMessage) {
                                console.log((errorMessage));
                            }
                        })
                    })
                    $("#update_course").submit(async(e) => {
                        e.preventDefault()
                        let id = $("#edit_id").val()
                        let data = {
                            name: $("#edit_name").val(),
                            alias: $("#edit_alias").val(),
                            affiliated_to: $("#edit_institute").val(),
                            duration: $("#edit_duration").val(),
                            pattern: $("#edit_pattern").val(),
                            fees: $("#edit_fees").val(),
                            intake: $("#edit_intake").val()
                        }
                        console.log(data);
                        await $.ajax(`${url}/master/updateCourse/${id}`, {
                            "dataType": "json",
                            type: 'PATCH',
                            data: data,
                            success: async function(data, status, xhr) {
                                alert("Record updated succesfully ! !")
                                window.location.href = $(location).attr('href')
                            },
                            error: function(jqxhr, textStatus, errorMessage) {
                                console.log((errorMessage));
                            }
                        })
                    })
                    $(document).on('click', '.delete', async function() {
                        let id = $(this).attr("id")
                        console.log("delete", id);
                        var userChoice = confirm("Do you want to Delete it ?");
                        console.log(userChoice)
                        if (userChoice == true) {
                            await $.ajax(`${url}/master/delCourse/${id}`, {
                                type: 'DELETE',
                                success: async function(data, status, xhr) {
                                    alert("Record Deleted Successfully ! !")
                                    window.location.href = $(location).attr('href')
                                },
                                error: function(jqxhr, textStatus, errorMessage) {
                                    console.log((errorMessage));
                                }
                            })
                            return true;
                        } else {
                            return false;
                        }
                    })
                    $(document).on('click', '.edit', async function() {
                        let id = $(this).attr("id")
                        console.log("edit", id);
                        await $.ajax(`${url}/master/getCourse/${id}`, {
                            type: 'GET',
                            success: async function(data, status, xhr) {
                                $("#edit_id").val(data[0].id)
                                $("#edit_name").val(data[0].name)
                                $("#edit_alias").val(data[0].alias)
                                $("#edit_affiliated_to").val(data[0].affiliated_to)
                                $("#Courses-all").removeClass("active")
                                $("#Courses-edit").addClass("active")
                            },
                            error: function(jqxhr, textStatus, errorMessage) {
                                console.log((errorMessage));
                            }
                        })
                    })
                })
            </script>
</body>

</html>